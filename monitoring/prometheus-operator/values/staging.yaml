kube-prometheus-stack:
  prometheusOperator:
    admissionWebhooks:
      enabled: false
  
  prometheus:
    prometheusSpec:
      retention: 30d
      # ServiceMonitor namespace selector (empty = all namespaces)
      serviceMonitorNamespaceSelector: {}
      serviceMonitorSelector: {}
      # Alertmanager configuration
      alerting:
        alertmanagers:
          - namespace: monitoring
            name: kube-prometheus-stack-alertmanager
            port: web
      storageSpec:
        volumeClaimTemplate:
          spec:
            storageClassName: gp3
            accessModes: ["ReadWriteOnce"]
            resources:
              requests:
                storage: 100Gi

  alertmanager:
    alertmanagerSpec:
      retention: 120h
      # Alertmanager configuration
      config:
        global:
          resolve_timeout: 5m
          # Configure SMTP for email notifications (update with your SMTP server)
          # smtp_smarthost: 'smtp.gmail.com:587'
          # smtp_from: 'alerts@yourcompany.com'
          # smtp_auth_username: 'your-email@gmail.com'
          # smtp_auth_password: 'your-password'
        # Route configuration
        route:
          group_by: ['alertname', 'cluster', 'service']
          group_wait: 10s
          group_interval: 10s
          repeat_interval: 12h
          receiver: 'default'
          routes:
            - match:
                severity: critical
              receiver: 'critical-alerts'
              continue: true
            - match:
                severity: warning
              receiver: 'warning-alerts'
        # Receivers
        receivers:
          - name: 'default'
            # Email receiver example (uncomment and configure)
            # email_configs:
            #   - to: 'team@yourcompany.com'
            #     send_resolved: true
            #     headers:
            #       Subject: '{{ .GroupLabels.alertname }} - {{ .Status }}'
            # Slack receiver example (uncomment and configure)
            # slack_configs:
            #   - api_url: 'YOUR_SLACK_WEBHOOK_URL'
            #     channel: '#alerts'
            #     send_resolved: true
            #     title: '{{ .GroupLabels.alertname }}'
            #     text: '{{ range .Alerts }}{{ .Annotations.description }}{{ end }}'
          - name: 'critical-alerts'
            # Email receiver for critical alerts
            # NOTE: SMTP settings must be configured in the global section above before uncommenting email_configs
            # email_configs:
            #   - to: 'oncall@yourcompany.com'  # UPDATE: Replace with your on-call email
            #     send_resolved: true
            #     headers:
            #       Subject: 'üö® CRITICAL: {{ .GroupLabels.alertname }}'
            # Slack receiver for critical alerts
            # slack_configs:
            #   - api_url: 'YOUR_SLACK_WEBHOOK_URL'
            #     channel: '#critical-alerts'
            #     send_resolved: true
            #     title: 'üö® CRITICAL: {{ .GroupLabels.alertname }}'
            #     text: '{{ range .Alerts }}{{ .Annotations.description }}{{ end }}'
          - name: 'warning-alerts'
            # Email receiver for warning alerts
            # email_configs:
            #   - to: 'team@yourcompany.com'
            #     send_resolved: true
            #     headers:
            #       Subject: '‚ö†Ô∏è WARNING: {{ .GroupLabels.alertname }}'
            # Slack receiver for warning alerts
            # slack_configs:
            #   - api_url: 'YOUR_SLACK_WEBHOOK_URL'
            #     channel: '#alerts'
            #     send_resolved: true
            #     title: '‚ö†Ô∏è WARNING: {{ .GroupLabels.alertname }}'
            #     text: '{{ range .Alerts }}{{ .Annotations.description }}{{ end }}'

  grafana:
    adminPassword: external-secrets
    service:
      type: ClusterIP  # Internal only - access via port-forward
    persistence:
      enabled: true
      size: 20Gi
      storageClassName: gp3
    datasources:
      datasources.yaml:
        apiVersion: 1
        datasources:
          - name: Prometheus
            type: prometheus
            url: http://kube-prometheus-stack-prometheus:9090
            isDefault: true
          - name: Loki
            type: loki
            url: http://loki-gateway:80

